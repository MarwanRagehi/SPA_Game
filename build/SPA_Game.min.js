/*! SPA_Game 2015-04-03 */
var app=app||{};app.Controller=Backbone.Model.extend({initialize:function(){console.log("Controller is born!")},defaults:{name:"Anynomos",day:0,settlers:0,max_settlers:0,workers:0,wood:0,stone:0,planks:0,storage:0,max_storage:0}});var app=app||{};app.Tile=Backbone.Model.extend({initialize:function(){console.log("Tile is born!")},defaults:{name:"Empty tile",img:"images/2x2.png",number:0,tier:0,level:0,cost_workers:0,cost_wood:0,cost_stone:0,cost_planks:0,require_wood:0,require_stone:0,produce_wood:0,produce_stone:0,produce_planks:0,max_storage:0,max_settlers:0}});var app=app||{};app.Building=Backbone.Model.extend({initialize:function(){console.log("Building is born!")},defaults:{name:"Empty tile",img:"images/2x2.png",level:0,tier:0,cost_workers:0,cost_wood:0,cost_stone:0,require_wood:0,require_stone:0,produce_wood:0,produce_stone:0,max_storage:0,max_settlers:0}});var app=app||{};app.TileGroup=Backbone.Collection.extend({model:app.Tile});var app=app||{};app.allTileView=Backbone.View.extend({render:function(){return this.collection.each(this.addTile,this),this},addTile:function(a){var b=new app.TileView({model:a});this.$el.append(b.render().el)}});var app=app||{};app.ControllerView=Backbone.View.extend({id:"#controllerView.js line5",template:_.template($("#build-main-info").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{"click #next-day":"nextDay"},nextDay:function(){main.set("day",main.get("day")+1),$.each(tile,function(a){1==tile[a].get("tier")&&main.get("storage")<=main.get("max_storage")&&(main.set("stone",main.get("stone")+tile[a].get("produce_stone")),main.set("wood",main.get("wood")+tile[a].get("produce_wood")))}),$.each(tile,function(a){2==tile[a].get("tier")&&main.get("wood")>=tile[a].get("require_wood")&&main.get("storage")<=main.get("max_storage")&&(main.set("wood",main.get("wood")-tile[a].get("require_wood")),main.set("planks",main.get("planks")+tile[a].get("produce_planks")))}),main.set("storage",main.get("stone")+main.get("wood")+main.get("planks")),mainView.render()}});var app=app||{};app.SelectedTile=Backbone.View.extend({id:"#tileInfoView.js line5",template:_.template($("#build-tile-info").html()),render:function(){console.log("now I am inside SelectedTile");var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{"click #upgrade":"upgradeTile","click #destroy":"destroyTile","click #upgrade-to-mason":"upgradeToMason","click #upgrade-to-wood-cutter":"upgradeToWoodCutter","click #upgrade-to-wood-swamill":"upgradeToSwamill","click #upgrade-to-residence":"upgradeToResidence","click #upgrade-to-storage":"upgradeToStorage"},upgradeTile:function(){var a=this.model.get("number");if(main.get("wood")>=self.tile[a].get("cost_wood")&&main.get("stone")>=self.tile[a].get("cost_stone")&&main.get("planks")>=self.tile[a].get("cost_planks")&&self.tile[a].get("level")<=10){main.set("wood",main.get("wood")-self.tile[a].get("cost_wood")),main.set("stone",main.get("stone")-self.tile[a].get("cost_stone")),main.set("planks",main.get("planks")-self.tile[a].get("cost_planks")),self.tile[a].set("level",self.tile[a].get("level")+1),self.tile[a].set("cost_wood",Math.round(2.5*self.tile[a].get("cost_wood")+10)),self.tile[a].set("cost_stone",Math.round(2.2*self.tile[a].get("cost_stone")+8)),self.tile[a].set("cost_planks",Math.round(1.5*self.tile[a].get("cost_planks")+10)),self.tile[a].set("require_wood",Math.round(1.9*self.tile[a].get("require_wood"))),self.tile[a].set("produce_wood",Math.round(1.9*self.tile[a].get("produce_wood"))),self.tile[a].set("produce_stone",Math.round(1.9*self.tile[a].get("produce_stone"))),self.tile[a].set("produce_planks",Math.round(1.9*self.tile[a].get("produce_planks"))),main.set("max_storage",main.get("max_storage")-tile[a].get("max_storage")),self.tile[a].set("max_storage",Math.round(2.9*self.tile[a].get("max_storage"))),main.set("max_storage",main.get("max_storage")+tile[a].get("max_storage")),main.set("max_settlers",main.get("max_settlers")-tile[a].get("max_settlers")),self.tile[a].set("max_settlers",Math.round(2.2*self.tile[a].get("max_settlers"))),main.set("max_settlers",main.get("max_settlers")+tile[a].get("max_settlers"));var b=tile[a].get("name"),c=tile[a].get("level");switch(b){case"Wood Cutter":switch(c){case 3:tile[a].set("img","images/Pinewood_Cutter_Level_2.png");break;case 5:tile[a].set("img","images/Pinewood_Cutter_Level_3.png");break;case 7:tile[a].set("img","images/Pinewood_Cutter_Level_4.png");break;case 9:tile[a].set("img","images/Pinewood_Cutter_Level_5.png")}break;case"Mason":switch(c){case 3:tile[a].set("img","images/Mason_Level_2.png");break;case 5:tile[a].set("img","images/Mason_Level_3.png");break;case 7:tile[a].set("img","images/Mason_Level_4.png");break;case 9:tile[a].set("img","images/Mason_Level_5.png")}break;case"Wood Swamill":switch(c){case 3:tile[a].set("img","images/Pinewood_Sawmill_Level_2.png");break;case 5:tile[a].set("img","images/Pinewood_Sawmill_Level_3.png");break;case 7:tile[a].set("img","images/Pinewood_Sawmill_Level_4.png");break;case 9:tile[a].set("img","images/Pinewood_Sawmill_Level_5.png")}break;case"Storage":switch(c){case 3:tile[a].set("img","images/Storehouse_Level_2.png");break;case 5:tile[a].set("img","images/Storehouse_Level_3.png");break;case 7:tile[a].set("img","images/Storehouse_Level_4.png");break;case 9:tile[a].set("img","images/Storehouse_Level_5.png")}break;case"Residence":switch(c){case 3:tile[a].set("img","images/Residence_Level_2.png");break;case 5:tile[a].set("img","images/Residence_Level_3.png");break;case 7:tile[a].set("img","images/Residence_Level_4.png");break;case 9:tile[a].set("img","images/Residence_Level_5.png")}}console.log("upgraded "+selectedTile.model.get("number"))}this.updateAllTiles()},destroyTile:function(){var a=this.model.get("number");main.set("max_storage",main.get("max_storage")-self.tile[a].get("max_storage")),main.set("max_settlers",main.get("max_settlers")-self.tile[a].get("max_settlers")),self.tile[a].set(empty_tile.attributes),this.updateAllTiles(),console.log("removed "+selectedTile.model.get("number"))},upgradeToMason:function(){var a=this.model.get("number");self.tile[a].set(mason.attributes),self.tile[a].set("cost_wood",Math.round(2.5*self.tile[a].get("level")+10)),self.tile[a].set("cost_stone",Math.round(1.2*self.tile[a].get("level")+8)),console.log("upgraded "+selectedTile.model.get("number")+" to mason "),this.updateAllTiles()},upgradeToWoodCutter:function(){var a=this.model.get("number");self.tile[a].set(wood_cutter.attributes),self.tile[a].set("cost_wood",Math.round(1.5*self.tile[a].get("level")+10)),self.tile[a].set("cost_stone",Math.round(2.2*self.tile[a].get("level")+8)),console.log("upgraded "+selectedTile.model.get("number")+" to wood_cutter "),this.updateAllTiles()},upgradeToSwamill:function(){var a=this.model.get("number");self.tile[a].set(wood_swamill.attributes),self.tile[a].set("cost_planks",Math.round(1.5*self.tile[a].get("level")+10)),self.tile[a].set("cost_stone",Math.round(3.2*self.tile[a].get("level")+8)),console.log("upgraded "+selectedTile.model.get("number")+" to wood_swamill "),this.updateAllTiles()},upgradeToResidence:function(){var a=this.model.get("number");self.tile[a].set(residence.attributes),main.set("max_settlers",main.get("max_settlers")+tile[a].get("max_settlers")),console.log("upgraded "+selectedTile.model.get("number")+" to residence "),this.updateAllTiles()},upgradeToStorage:function(){var a=this.model.get("number");self.tile[a].set(storage.attributes),main.set("max_storage",main.get("max_storage")+tile[a].get("max_storage")),console.log("upgraded "+selectedTile.model.get("number")+" to storage "),this.updateAllTiles()},updateAllTiles:function(){this.render(),tileGroupView=new app.allTileView({collection:tileGroup}),$("#draw-tile-map").html(tileGroupView.render().el),mainView.render()}});var app=app||{};app.StartUpView=Backbone.View.extend({id:"#startupView.js line5",template:_.template($("#build-game-startup").html()),initialize:function(){},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{"click #submit-info":"startGame"},startGame:function(){var a=$("#player-name").val(),b=parseInt($("#starting-wood").val()),c=parseInt($("#starting-stone").val()),d=parseInt($("#starting-planks").val());main.set({name:a,wood:b,stone:c,planks:d}),$("#draw-game-startup").removeClass("startup"),tileGroupView=new app.allTileView({collection:tileGroup}),$("#draw-tile-map").html(tileGroupView.render().el),mainView.nextDay(),this.remove()}});var app=app||{};app.SelectedTile=Backbone.View.extend({id:"#tileInfoView.js line5",template:_.template($("#build-tile-info").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.TileView=Backbone.View.extend({className:"tile",template:_.template($("#build-tile-map").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},infoTemplate:_.template($("#build-tile-info").html()),events:{mouseover:"addBgColor",mouseout:"removeBgColor",click:"showSelectedTile","click #Upgrade":"upgradeTile"},addBgColor:function(){this.$el.addClass("bgColorImage")},removeBgColor:function(){this.$el.removeClass("bgColorImage")},showSelectedTile:function(){console.log("clicked showSelectedTile"),selectedTile=new app.SelectedTile({model:this.model}),$("#draw-tile-info").html(selectedTile.render().el)},upgradeTile:function(){console.log("upgraded")}});